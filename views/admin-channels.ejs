<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manage 24/7 Channels</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cogs"></i> Admin Panel</h1>
            <div class="profile-dropdown">
                <div class="profile-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="dropdown-content">
                    <a href="/admin/change-credentials"><i class="fas fa-key"></i> Change Credentials</a>
                    <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>

        <% if (typeof error !== 'undefined' && error) { %>
            <p style="color: red; background-color: #ffe0e0; padding: 10px; border-radius: 5px; margin-bottom: 15px;"><%= error %></p>
        <% } %>

        <!-- Navigation Tabs -->
        <%- include('admin-nav', { page: 'channels' }) %>

        <!-- Add/Edit Form -->
        <form 
            action="<%= channelToEdit ? '/admin/channels/edit/' + channelToEdit.id : '/admin/channels/add' %>" 
            method="POST" 
            class="match-form"
        >
            <h2><%= channelToEdit ? 'Edit Channel' : 'Add New Channel' %></h2>
            
            <div class="form-group">
                <input 
                    type="text" 
                    name="name" 
                    placeholder="Channel Name (e.g., ABC News)" 
                    required 
                    value="<%= channelToEdit ? channelToEdit.name : '' %>"
                >
                <input 
                    type="url" 
                    name="logo_url" 
                    placeholder="Logo URL (Optional)"
                    value="<%= channelToEdit ? channelToEdit.logo_url : '' %>"
                >
            </div>
            <div class="form-group" style="grid-template-columns: 1fr;">
                <input 
                    type="url" 
                    name="stream_url" 
                    placeholder="Stream URL (M3U8)" 
                    required
                    value="<%= channelToEdit ? channelToEdit.stream_url : '' %>"
                >
            </div>

            <button type="submit" class="btn">
                <%= channelToEdit ? 'Update Channel' : 'Add Channel' %>
            </button>
            <% if (channelToEdit) { %>
                <a href="/admin/channels" class="btn btn-cancel">Cancel Edit</a>
            <% } %>
        </form>

        <!-- Channels List -->
        <h2>Existing Channels</h2>
        <div class="table-wrapper">
            <table class="match-table">
                <thead>
                    <tr>
                        <th>Channel</th>
                        <th>Stream URL</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (channels.length > 0) { %>
                        <% channels.forEach(channel => { %>
                            <tr>
                                <td>
                                    <div class="match-cell">
                                        <% if (channel.logo_url) { %>
                                            <img src="<%= channel.logo_url %>" alt="<%= channel.name %> Logo">
                                        <% } %>
                                        <span><%= channel.name %></span>
                                    </div>
                                </td>
                                <td>
                                    <a href="<%= channel.stream_url %>" target="_blank" rel="noopener noreferrer">
                                        <%= channel.stream_url.substring(0, 50) %>...
                                    </a>
                                </td>
                                <td class="actions">
                                    <a href="/admin/channels/edit/<%= channel.id %>" class="btn btn-edit">Edit</a>
                                    <a 
                                        href="/admin/channels/delete/<%= channel.id %>" 
                                        class="btn btn-delete" 
                                        onclick="return confirm('Are you sure you want to delete this channel?')"
                                    >
                                        Delete
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="3" style="text-align: center;">No channels found.</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>